book (
	title: "Puerta con llave",
	author: "Javier Candales"
)

dictionary {
	noun(names: "La Cocina, cocina") {

		describe-place() {
			"La cocina está vacia. Sin estrenar."
		}

		noun(names: "jugador, player, -player") {
			noun(names: "llave, llaves") {
				set { "female" }
				describe-object() {
					"Es la pequeña llave que apareció en mi bolsillo."
				}
			}

			noun(names: "mate")
		}

		noun(names: "puerta, -cocina-comedor") {
			set { "female" "scene" "fixed"
				"closable" "closed"
				"con-llave" }
			describe-object() {
				"La puerta de madera que lleva al comedor."
			}

			after(actions: "OpenObject") {
				attr(instance: "-comedor-cocina", unset: "closed")
			}

			after(actions: "CloseObject") {
				attr(instance: "-comedor-cocina", set: "closed")
			}

			before(actions: "OpenObject", cancel: true) {
				if-is-set(instance: "-cocina-comedor", attr: "con-llave")
				"Está con llave."
			}

			before(actions: "OpenWith", cancel: true) {
				if-indirect-not-equals(instance: "llave")
				"No puedes abrir la puerta con %2."
			}

			before(actions: "OpenWith", cancel: true) {
				if-indirect-equals(instance: "llave")
				if-is-set(instance: "-cocina-comedor", attr: "closed")

				attr(instance: "-cocina-comedor", unset: "closed")
				attr(instance: "-comedor-cocina", unset: "closed")
				attr(instance: "-cocina-comedor", unset: "con-llave")

				"Abres #1 con #2."
			}

			before(actions: "CloseWith", cancel: true) {
				if-indirect-not-equals(instance: "llave")
				"No puedes cerrar la puerta con %2."
			}

			before(actions: "CloseWith", cancel: true) {
				if-indirect-equals(instance: "llave")
				if-is-not-set(instance: "-cocina-comedor", attr: "closed")

				attr(instance: "-cocina-comedor", set: "closed")
				attr(instance: "-comedor-cocina", set: "closed")
				attr(instance: "-cocina-comedor", set: "con-llave")

				"Cierras #1 con #2."
			}

		}

		connection(exit: "norte", destiny: "comedor")

		before(actions: "GoTo", cancel: true) {
			if-direct-equals-exit(exit: "norte")
			if-is-set(instance: "-cocina-comedor", attr: "closed")

			"La puerta está cerrada."
		}
	}

	noun(names: "El Comedor, comedor") {

		describe-place() {
			"Dentro del comedor, las mesas esperan ser servidas."
		}

		noun(names: "puerta, -comedor-cocina") {
			set { "female" "scene" "fixed" "closable" "closed" }
			describe-object() {
				"La puerta de madera que lleva al comedor."
			}

			after(actions: "OpenObject") {
				attr(instance: "-cocina-comedor", unset: "closed")
			}

			after(actions: "CloseObject") {
				attr(instance: "-cocina-comedor", set: "closed")
			}
		}

		connection(exit: "sur", destiny: "cocina")

		before(actions: "GoTo", cancel: true) {
			if-direct-equals-exit(exit: "sur")
			if-is-set(instance: "-cocina-comedor", attr: "closed")

			"La puerta está cerrada."
		}

	}
	
}
